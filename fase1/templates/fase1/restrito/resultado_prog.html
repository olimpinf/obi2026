{% extends "base_restricted.html" %}
{% load obi_extras %}

{% block head_extra %}
<script>
  function _focus_next(e) {
      $(e).parent().parent().next().find('input').focus();
}
</script>
{% endblock head_extra %}

{% block body_onload %}
{# document.getElementById('{{ focus }}_compet_points').focus(); #}
{% if focus %}
_focus_next(document.getElementById('{{ focus }}_compet_points'));
{% endif %}
{% endblock body_onload %}

{% block content %}
<h1>{{ pagetitle }}  </h1>


{% comment %}
<p><font color="red">A classificação para a modalidade Programação ainda não foi computada</font></p>
{% endcomment %}

{% if False %}
<p>Ainda não disponível.</p>
{% else %}

{% if items.paginator.count > 0 %}
  {% if items.paginator.count == 1 %}
<p>{{ items.paginator.count }} competidor selecionado, total de {{ total }} competidores inscritos</p>
  {% else %}
<p>{{ items.paginator.count }} competidores selecionados, total de {{ total }} competidores inscritos</p>
{% endif %}

<table class='admin' width="100%">
  <tr>
    <th width="">Núm. Inscr.</th>
    <th width="">Nome</th>
    <th class="center">Modalidade</th>
    <th class="">Pontuação</th>
    <th class="">Classif.</th>
  </tr>
  
  {% for c in items %}
  <tr class="{% cycle 'odd' 'even' %}">
    <td>{{ c.compet_id|obi_format_compet_id }}</td>
    <td>{% if c.compet_points_fase1 >= 0 %}<a href="{% url 'exams:show_results_coord' exam_descriptor c.compet_id %}" target="_blank">{{ c.compet_name }}</a>{% else %}{{c.compet_name}}{% endif %}</td>
    <td class="center">{{ c.compet_type|obi_format_compet_type_short }}</td>
    <td class="center">{{c.compet_points_fase1|default_if_none:'-'}}</td>

    {% if show_classif %}
      <td class="center">{% if c.compet_classif_fase1 %}
        <font color="green">Sim</font>
	{% else %}<font color="red">Não</font>{% endif %}
      </td>
    {% else %}
    <td class="center"><img src="/static/admin/img/icon-unknown.svg" alt="None"></td>
    {% endif %}
    {% comment %}
    <td class="center"><img src="/static/admin/img/icon-unknown.svg" alt="None"></td>
    {% endcomment %}

  </tr>
  {% endfor %}
</table>
{% else %}
<p>Não há competidores inscritos com o filtro selecionado.</p>
{% endif %}
{% if items.has_other_pages %}
  <ul class="nav-pagination">
        <li>Página:</li>
    {% for i in items.paginator.page_range %}
      {% if items.number == i %}
        <li class="current"><span>{{ i }}</span></li>
      {% else %}
        <li><a href="{%url 'fase1:resultado_prog' %}?page={{ i }}">{{ i }}</a></li>
      {% endif %}
    {% endfor %}
        <li><a class="show_all" href="{%url 'fase1:resultado_prog' %}?page=all">Mostrar tudo</a></li>
  </ul>
{% endif %}

{% if compets_desclassificados %}
<h2 class="mt-4">Competidores Desclassificados</h2>

<p>Os competidores abaixo foram desclassificados por violar as regras da OBI2025 (uso de IA, ou cópia entre competidores, ou
  realização da prova em casa). As soluções foram analisadas individualmente pela equipe de correção,
  que comprovou a violação. Solicitamos aos coordenadores que informem os alunos envolvidos. A
  verificação manual continua, e mais competidores poderão ser desclassificados.
  
<table class='admin' width="100%">
  <tr>
    <th width="">Núm. Inscr.</th>
    <th width="">Nome</th>
    <th class="center">Modalidade</th>
  </tr>
  
  {% for c in compets_desclassificados %}
  <tr class="{% cycle 'odd' 'even' %}">
    <td>{{ c.compet_id|obi_format_compet_id }}</td>
    <td>{% if c.compet_points_fase1 >= 0 %}<a href="{% url 'exams:show_results_coord' exam_descriptor c.compet_id %}" target="_blank">{{ c.compet_name }}</a>{% else %}{{c.compet_name}}{% endif %}</td>
    <td class="center">{{ c.compet_type|obi_format_compet_type_short }}</td>

  </tr>
  {% endfor %}
</table>
{% endif %}
{% endif %}


{% endblock %}

{% block content-related %}
<h1 class="visuallyhidden">Instruções</h1>
<div role="complementary">

  {% block browse-wrapper %}
  {% block browse %}
<form action="" method="post">
  {% csrf_token %}
  {% if form.errors %}
     <p class="errorlist">Por favor corrija os erros indicados abaixo.</p>
  {% endif %}
  {% for fieldset in form.fieldsets %}
  <fieldset class="border p-2">
    <legend class="float-none w-auto p-2">{{ fieldset.title }}</legend>    
    <ul>
      {% for field in fieldset %}
        <li>
          {{ field.label_tag }}
          {{ field }}
          {% if field.help_text %}
	    <small class="form-text">{{ field.help_text|safe }}</small>
	  {% endif %}
          {{ field.errors }}
        </li>
      {% endfor %}
    </ul>
  </fieldset>
  {% endfor %}
</form>

  
    {% endblock browse %}
  {% endblock browse-wrapper %}

  {% block breadcrumbs-wrapper %}
  <h2>Observações</h2>
  <!--p>A Classificação será divulgada de acordo com o Calendário da OBI2022.</p-->
		     
  <p>Clique no nome do competidor para ver detalhes da correção (o
    nome pode ser clicado apenas para competidores que efetivamente
  <p>Resultados finais, já considerando a aplicação da regra de
    classificação "nacional", ou seja, os 5% melhores classificados nacionalmente
    que não estejam ainda classificados pela regra "local" (15%
    melhores classificados na escola) são também classificados para a
    Fase 2.
  </p>

  {% comment %}
    participaram da prova).
  <p>Os resultados são preliminares. Por favor consulte o
    <a href="/calendario">Calendário da OBI2025</a> para datas de divulgação de resultados.
  </p>
  <p>Resultados Preliminares, já considerando a aplicação da regra de
    classificação "nacional", ou seja, os 5% melhores classificados nacionalmente
    que não estejam ainda classificados pela regra "local" (15%
    melhores classificados na escola) são também classificados para a
    Fase 2.
  </p>
  <p>Novos competidores podem ser classificados como resultado de
    recorreções, mas nenhum competidor já classificado deixará de
    ser classificado.
  </p-->
  <!--font color="red">
    <p>
      Neste momento da competição os resultados mostram (somente para
      os coordenadores) apenas os
    classificados com base no resultado da escola (os 15% melhores da
    escola são classificados para a Fase 2).
  <p>
    Outros competidores podem ainda ser classificados pela regra de
    classificação geral (os 5% melhores classificados nacionalmente
    que não estejam ainda classificados são também classificados para
    a Fase 2). Essa regra será aplicada apenas quando todos os
    resultados forem finais.
  </p>
  </font-->
  {% endcomment %}
  {% endblock breadcrumbs-wrapper %}
      
</div>
{% endblock %}
