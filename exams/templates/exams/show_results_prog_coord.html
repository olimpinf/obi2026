{% extends "base_restricted_compet.html" %}
{% load obi_extras exams static %}

{% block head_extra %}
    <link rel="stylesheet" href="{% static 'assets/css/bootstrap.css' %}" >
    <link rel="stylesheet" href="{% static 'assets/css/cws_style.css' %}" >
    <!--script type="text/javascript" src="{% static 'assets/js/bootstrap.js' %}"></script-->
    <script type="text/javascript" src="{% static 'assets/js/cws_utils.js' %}"></script>
    <script>

var utils = new CMS.CWSUtils("url", "url", "contest_name",
                             '{% now "U" %}',
                             '{% now "U" %}',
                             '{% now "U" %}',
                             '{% now "U" %}',
                             {{ 0 }});
$(document).on("click", "#submission_list tbody tr td.status .details", function(event){
    console.log("onclick");
    var submission_id = $(this).parent().parent().attr("data-submission");
    console.log("submission_id", submission_id);
    var modal = $("#submission_detail");
    var modal_body = modal.children(".modal-body");
    modal_body.html('<div class="loading"><img src="{% static "img/loading.gif" %}"/>carregando...</div>');
    modal_body.load(submission_id, function() {
	console.log("in load");
        $(".score_details .subtask .subtask-head").each(function () {
            $(this).prepend('<i class="icon-chevron-right"></i>');
        });
        $(".score_details .subtask .subtask-head").click(function () {
            $(this).parent().toggleClass("open");
            if ($(this).parent().hasClass("open")) {
                $(this).children("i").removeClass("icon-chevron-right").addClass("icon-chevron-down");
            } else {
                $(this).children("i").removeClass("icon-chevron-down").addClass("icon-chevron-right");
            }
        });
        $(".score_details table.testcase-list").addClass("table table-bordered table-striped");
        $(".score_details table.testcase-list tbody tr:not(.undefined) td.outcome").each(function () {
            $(this).html('<span class=\"outcome\" >'  + $(this).text() + "</span>");
        });
	console.log(modal.html());
    });
    console.log("will call modal");
    modal.modal("show");
});

function get_score_class (score, max_score) {
    if (score <= 0) {
        return "score_0";
    } else if (score >= max_score) {
        return "score_100";
    } else {
        return "score_0_100";
    }
};
</script>
{% endblock head_extra %}

{% block content %}
<span class="exam_header">{{ f.exam_header }}</span>
<h1>{{ pagetitle }}</h1>

<h2>Submissões realizadas</h2>
{% if not submissions %}
Não há submissões.
{% else %}
{% regroup submissions by task_title as subm_list %}
{% for task_title in subm_list %}

<h4>{{task_title.grouper}}</h4>
<table id="submission_list" class="simple cwstable table-bordered table-striped">
    <colgroup>
        <col class="time"/>
        <col class="status"/>
        <col class="total_score"/>
        <col class="files"/>
    </colgroup>
    <thead>
        <tr>
            <th class="time">Hora</th>
            <th class="status">Status</th>
            <th class="total_score">Pontuação</th>
            <th class="files">Arquivos</th>
        </tr>
    </thead>
    <tbody>
    {% for s in task_title.list %} {% with s_idx=forloop.counter %}
      
        {% get_submission_result submission_results s.submission_id as sr %}   
        {% include "exams/includes/submission_row.html" %}

        {% endwith %}
    {% endfor %}
    </tbody>
</table>
{% endfor %}
{% endif %}


{% comment %}
<div class="modal fade hide wide" id="submission_detail">
  <div class="modal-header">
    <button type="button" class="close" data-dismiss="modal">&#xD7;</button>
    <h3>Detalhes da submissão</h3>
  </div>
  <div class="modal-body">
  </div>
  <div class="modal-footer">
    <a href="#" class="btn" data-dismiss="modal">Fechar</a>
  </div>
</div>

{% endcomment %}

{% endblock %}

{% block content-related %}

  {% block browse-wrapper %}
  <h4>Total de Pontos: {{ f.total_points }}</h4>
  {% if f.next_phase %}
  Classificado para {{f.next_phase}}: {{f.classif_next_phase}}
  {% endif %}
<hr>

  {% comment %}
  <h4>Tarefas</h4>
  {% include "exams/includes/contents_review_tasks.html" %}
  {% endcomment %}
  
    {% block browse %}
    {% endblock browse %}
  {% endblock browse-wrapper %}

  {% block breadcrumbs-wrapper %}
  {% endblock breadcrumbs-wrapper %}
</div>

{% endblock %}
